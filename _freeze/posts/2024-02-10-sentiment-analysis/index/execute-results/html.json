{
  "hash": "0622e1c0241a5fe88f6607f2d9c4741d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Text Sentiment Analysis\"\ndescription: \"Extracting text and performing sentiment analysis on Steinbeck's *East of Eden*\"\nauthor:\n  - name: Madison Calbert\n    url: https://madicalbert.github.io/\n    affiliation: ESM 244 Advanced Data Analysis - Master of Environmental Science & Management Program @ The Bren School (UCSB)\n    affiliation-url: https://bren.ucsb.edu/masters-programs/master-environmental-science-and-management \ndate: 02-10-2024\ncategories: [R, Sentiment Analysis, Data Visualization] # self-defined categories\ncitation: \n  url: https://madicalbert.github.io/posts/2024-02-10-sentiment-analysis/ \nimage: preview-image.png\ndraft: false # setting this to `true` will prevent your post from appearing on your listing page until you're ready!\nformat: \n  html: \n    code-fold: true\n    toc: true \n    embed-resources: true\neditor: visual\nexecute: \n  echo: true\n  message: false\n  warning: false\n---\n\n\n\n![First edition dust cover jacket of *East of Eden* (1952) by American author John Steinbeck. Photo retrieved from Wikipedia page.](images/East_of_Eden.jpeg)\n\n## Overview\n\nIn this report, I analyze John Steinbeck's classic novel, \"East of Eden\", to determine the most frequently used words and overall sentiments throughout the book. Figure 1 displays the most frequently used words in each chapter for Chapters 1 - 16, and Figure 2 visualizes a cloud map of most frequenlty used word for just Chapter 1. Figures 3 and 4 portrays the sentiment analysis for Chapters 1-16.\n\n## Text Analysis\n\n-   Load libraries needed for analysis\n-   Load in the pdf of \"East of Eden\"\n-   Convert the pdf text into a data frame\n-   Wrangle the data to get tokens into tidy format and remove stop words\n-   Determine word counts by chapter\n-   Plot it in a bar graph\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n### Load Packages\n\nlibrary(tidyverse)\nlibrary(tidytext)\nlibrary(pdftools)\nlibrary(ggwordcloud)\nlibrary(textdata)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n### Get East of Eden Script loaded in\n\neoe_text <- pdftools::pdf_text(here::here('posts', '2024-02-10-sentiment-analysis','data', 'East-of-Eden.pdf'))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n### Get PDF script text into a data frame\n\neoe_lines <- data.frame(eoe_text) %>% \n  mutate(page = 1:n()) %>%\n  mutate(text_full = str_split(eoe_text, pattern = '\\\\n')) %>% \n  unnest(text_full) %>% \n  mutate(text_full = str_trim(text_full)) \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\neoe_chapts <- eoe_lines %>% \n  slice(-(1:247)) %>% \n  mutate(chapter = ifelse(str_detect(text_full, \"Chapter\"), text_full, NA)) %>% \n  fill(chapter, .direction = 'down') %>% \n  separate(col = chapter, into = c(\"ch\", \"num\"), sep = \" \") %>% \n  mutate(chapter = as.numeric(as.roman(num)))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\neoe_words <- eoe_chapts %>% \n  unnest_tokens(word, text_full) %>% \n  select(-eoe_text)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\neoe_wordcount <- eoe_words %>% \n  count(chapter, word)\n\nwordcount_clean <- eoe_wordcount %>% \n  anti_join(stop_words, by = 'word')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntop_5_words <- wordcount_clean %>% \n  filter(chapter == 1:16) %>% \n  group_by(chapter) %>% \n  arrange(-n) %>% \n  slice(1:5) %>%\n  ungroup()\n\n# Make some graphs: \nggplot(data = top_5_words, aes(x = n, y = word)) +\n  geom_col(fill = \"darkgreen\") +\n  facet_wrap(~chapter, scales = \"free\")+\n  theme_minimal()+\n  labs(x = \" \", \n       y = \" \")\n```\n\n::: {.cell-output-display}\n![Figure 1: Top 5 Words per Chapter. Figure 1 portrays the top 5 most frequently used words per chapter for chapters 1 through 16. The most commonly used word is 'Adam' in Chapter 10.](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\n## Word Cloud\n\nCreate a visualization for most frequently used words in Chapter 1:\n\n-   Filter for only Chapter 1\n-   Determine the top 100 most used words\n-   Plot it\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nch1_top100 <- wordcount_clean %>% \n  filter(chapter == 1) %>% \n  arrange(-n) %>% \n  slice(1:100)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nch1_cloud <- ggplot(data = ch1_top100, aes(label = word)) +\n  geom_text_wordcloud(aes(color = n, size = n), shape = \"diamond\") +\n  scale_size_area(max_size = 6) +\n  scale_color_gradientn(colors = c(\"darkgreen\",\"blue\",\"purple\")) +\n  theme_minimal()\n\nch1_cloud\n```\n\n::: {.cell-output-display}\n![Figure 2: East of Eden Chapter 1 Word Cloud. Fig 2 visualzes the most frequently used words from Chapter 1. As the novel starts out with a thorough description of the setting, the Salinas Valley, there are a lot of words describing the geographical location and physical attributes of Central California.](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n\n## Sentiment Analysis\n\nDetermine the overall sentiment (positive or negative) for each chapter:\n\n-   Load in the affin lexicon\n-   Bind the affin words to EOE words\n-   Determine positive and negative word counts\n-   Plot it by chapter\n-   Consider the log ratios and plot it\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nafinn_lex <- get_sentiments(lexicon = \"afinn\")\n### you may be prompted to download an updated lexicon - say yes!\n\n# Let's look at the pretty positive words:\nafinn_pos <- get_sentiments(\"afinn\") %>% \n  filter(value %in% c(3,4,5))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\neoe_afinn <- eoe_words %>% \n  filter(chapter == 1:16) %>% \n  inner_join(afinn_lex, by = 'word') ### why inner_join?\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbing_lex <- get_sentiments(lexicon = \"bing\")\n\nnrc_lex <- get_sentiments(lexicon = \"nrc\")\n\neoe_bing <- eoe_words %>% \n  filter(chapter == 1:16) %>% \n  inner_join(bing_lex, by = 'word')\n\nbing_counts <- eoe_bing %>% \n  group_by(chapter, sentiment) %>%\n  summarize(n = n())\n\n# Plot them: \nggplot(data = bing_counts, aes(x = sentiment, y = n, fill = sentiment)) +\n  geom_col() +\n  facet_wrap(~chapter) + \n  labs(\n    x = \" \", \n    y = \"Count\", \n    fill = \"Sentiment\")+\n  scale_fill_manual(values = c(\"positive\" = \"slateblue\", \"negative\" = \"darkred\"))+\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![Figure 3: East of Eden Sentiment Analysis. Fig 3 portrays the number of words per chapter that are associated with positive or negative connotations. Chapter 3 has the most negative words and Chapter 7 has the most positive words.](index_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# find log ratio score overall:\nbing_log_ratio_book <- eoe_bing %>% \n  summarize(n_pos = sum(sentiment == 'positive'),\n            n_neg = sum(sentiment == 'negative'),\n            log_ratio = log(n_pos / n_neg))\n\n# Find the log ratio score by chapter: \nbing_log_ratio_ch <- eoe_bing %>% \n  group_by(chapter) %>% \n  summarize(n_pos = sum(sentiment == 'positive'),\n            n_neg = sum(sentiment == 'negative'),\n            log_ratio = log(n_pos / n_neg)) %>%\n  mutate(log_ratio_adjust = log_ratio - bing_log_ratio_book$log_ratio) %>%\n  mutate(pos_neg = ifelse(log_ratio_adjust > 0, 'pos', 'neg'))\n\nggplot(data = bing_log_ratio_ch, \n       aes(x = log_ratio_adjust,\n           y = fct_rev(factor(chapter)),\n           fill = pos_neg)) +\n           # y = fct_rev(as.factor(chapter)))) +\n  geom_col() +\n  labs(x = 'Adjusted log(positive/negative)',\n       y = 'Chapter number') +\n  scale_fill_manual(values = c('pos' = 'slateblue', 'neg' = 'darkred')) +\n  theme_minimal() +\n  theme(legend.position = 'none')\n```\n\n::: {.cell-output-display}\n![Figure 4: Ratio of Sentiment Analysis. Fig 4 portrays the average sentiment for the whole book and compares each chapter to that average. Based on a log scale, a neutral chapter will equal 0 (ratio = 1), and a super positive chapter will show the same length as a super negative chapter but in the opposite directions. Chapter 2 was the most positive, and Chapters 3 and 9 were very negative.](index_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n\n## Works Cited\n\nSteinbeck, John. *East of Eden*. Penguin Classics, 2000. Retreived from: https://hitalki.org/blog/wp-content/uploads/2023/05/East-of-Eden.pdf\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}