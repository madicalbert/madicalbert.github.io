{
  "hash": "dfb368b8d62b0ce1103ca85fbb94e853",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Spatial Data Analysis\"\ndescription: \"Analyzing the spatial distribution of oil spill incidents in California from 2008.\"\nauthor:\n  - name: Madison Calbert\n    url: https://madicalbert.github.io/\n    affiliation: ESM 244 Advanced Data Analysis - Master of Environmental Science & Management Program @ The Bren School (UCSB)\n    affiliation-url: https://bren.ucsb.edu/masters-programs/master-environmental-science-and-management \ndate: 02-10-2024\ncategories: [R, Geospatial, Data Visualization] # self-defined categories\ncitation: \n  url: https://madicalbert.github.io/posts/2024-02-10-spatial-data/ \nimage: preview-image.png\ndraft: false # setting this to `true` will prevent your post from appearing on your listing page until you're ready!\nformat: \n  html: \n    code-fold: true\n    toc: true \n    embed-resources: true\neditor: visual\nexecute: \n  echo: true\n  message: false\n  warning: false\n---\n\n\n\n![Oil on the beach at Refugio State Park in Santa Barbara, California, on May 19, 2015. (U.S. Coast Guard).](images/oil-beach.jpeg)\n\n## Overview\n\nIn this report, I explore oil spill incidents throughout all 58 California counties in the year 2008. I used data from CA Department of Fish and Wildlife (CDFW) Oil Spill Incident Tracking \\[ds394\\] that was published on July 29, 2009. \"The Office of Spill Prevention and Response (OSPR) Incident Tracking Database is a statewide oil spill tracking information system. The data are collected by OSPR Field Response Team members for Marine oil spills and by OSPR Inland Pollution Coordinators and Wardens for Inland incidents. An 'incident', for purposes of this database, is a discharge or threatened discharge of petroleum or other deleterious material into the waters of the state.\" The purpose of this analysis is to develop a better understanding of which California counties have the most oil spill incidents and to spatially visualize the oil spill incidents.\n\n## Spatial Data Visualization\n\nCreate an interactive map displaying all oil spill incidents in each CA county:\n\n-   Load all Libraries needed for this analysis.\n\n-   Load the California county data shape files and the oil spill data sets.\n\n-   Convert the oil spill data set into a shape file and ensure it has the same coordinate reference system (CRS) as the California counties shape file.\n\n-   Perform a spatial join of CA counties over oil spill points.\n\n-   Make an interactive map of oil spill incidents by county.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(here)\nlibrary(sf) \nlibrary(terra) \nlibrary(tidyterra) \nlibrary(gstat)\nlibrary(stars)\nlibrary(janitor)\nlibrary(tmap)\nlibrary(spatstat)\n```\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n### spatial join \n\noil_ca_sf <- st_join(oil_sf, ca_counties_sf) ### points over counties\nca_oil_sf <- st_join(ca_counties_sf, oil_sf) ### counties over points\n```\n:::\n\n\n\n## Chloropleth Map\n\nDetermine the number of oil spill incidents in each county to display the counties with the greatest amount of oil spill occurrences:\n\n-   Group the oil spill data by county and summarize the number of oil spills in each county.\n\n-   Create the chloropleth map.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n### group by county and summarize \n\noil_counts_sf <- ca_oil_sf %>% \n  mutate(county = name) %>% \n  group_by(county) %>%\n  summarize(oil_counts = n())\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n### chloropleth map \n\nggplot(data = oil_counts_sf) +\n  geom_sf(aes(fill = oil_counts), color = \"white\", size = 0.1) +\n  scale_fill_gradientn(colors = c(\"lightgray\",\"orange\",\"red\")) +\n  theme_minimal() +\n  labs(fill = \"Number of oil spill incidents\")\n```\n\n::: {.cell-output-display}\n![Figure 2: Abundance of Oil Spill Incidents in 2008 in CA. This figure displays that the greatest number of oil spill incidents are occuring in Los Angeles and San Diego counties.](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n## Point Pattern Analysis\n\nPerform a point pattern analysis to assess whether oil spills tend to be more clustered or more uniform than complete spatial randomness:\n\n-   Convert oil observations to spatial point pattern\n\n-   Convert county boundaries to observation window\n\n-   Combine as a point pattern object (points + window)\n\n-   Plot it\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n### Convert oil observations to spatial point pattern\noil_ppp <- as.ppp(oil_sf) \n\n### Convert county boundary to observation window\nca_counties_win <- as.owin(ca_counties_sf) \n\n### Combine as a point pattern object (points + window):\noil_full <- ppp(oil_ppp$x, oil_ppp$y, window = ca_counties_win)\n\nplot(oil_full, main = \"Oil Spill Incidents from 2008\") \n```\n\n::: {.cell-output-display}\n![Figure 3: Point Pattern Analysis of Oil Spills in CA from 2008. This figure portrays that San Francisco, Los Angeles, and San Diego counties have the highest occurences of oil spills and clustering. The plus sign denotes illegal point or oils spills that fall outside the window.](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\nPlot the G function to determine clustering:\n\n-   Make a sequence of distances over which you'll calculate G(r)\n-   Calculate the actual and theoretical G(r) values, using 100 simulations of CSR for the \"theoretical\" outcome\n-   Check the output of gfunction, then gather this to plot series in ggplot, then make a graph in ggplot\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n### Make a sequence of distances over which you'll calculate G(r)\nr_vec <- seq(0, 10000, by = 100) \n\ngfunction_out <- envelope(oil_full, fun = Gest, r = r_vec, \n                          nsim = 100, verbose = FALSE) \n### Calculate the actual and theoretical G(r) values, using 100 \n### simulations of CSR for the \"theoretical\" outcome\n\ngfunction_out ### Check the output of gfunction, then...\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPointwise critical envelopes for G(r)\nand observed value for 'oil_full'\nEdge correction: \"km\"\nObtained from 100 simulations of CSR\nAlternative: two.sided\nSignificance level of pointwise Monte Carlo test: 2/101 = 0.0198\n.....................................................................\n     Math.label     Description                                      \nr    r              distance argument r                              \nobs  hat(G)[obs](r) observed value of G(r) for data pattern          \ntheo G[theo](r)     theoretical value of G(r) for CSR                \nlo   hat(G)[lo](r)  lower pointwise envelope of G(r) from simulations\nhi   hat(G)[hi](r)  upper pointwise envelope of G(r) from simulations\n.....................................................................\nDefault plot formula:  .~r\nwhere \".\" stands for 'obs', 'theo', 'hi', 'lo'\nColumns 'lo' and 'hi' will be plotted as shading (by default)\nRecommended range of argument r: [0, 6100]\nAvailable range of argument r: [0, 10000]\n```\n\n\n:::\n\n```{.r .cell-code}\n### Gather this to plot series in ggplot:\ngfunction_long <- gfunction_out %>% \n  as.data.frame() %>% \n  pivot_longer(cols = obs:hi, names_to = \"model\", values_to = \"g_val\")\n\n### Then make a graph in ggplot:\nggplot(data = gfunction_long, aes(x = r, y = g_val, group = model)) +\n  geom_line(aes(color = model)) +\n  theme_minimal() +\n  labs(x = 'radius (m)', y = 'G(r)')\n```\n\n::: {.cell-output-display}\n![Figure 4: G Function Analysis of Oil Spills in CA. This figure conveys that our observations are very clustered because the observation line is above the theoretical line.](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n\n```{.r .cell-code}\n### our observations are very clustered because it is above the theoretical line (CSR line in leture notes)\n```\n:::\n\n\n\n![A Snowy Plover is rehabilitated after being exposed to oil. Photo: Oiled Wildlife Care Network.](images/oiled_plover.jpg)\n\n## Works Cited\n\nOil Spill Incident Tracking \\[ds394\\]. California Department of Fish and Wildlife. Published July 29, 2009. Retrieved from: <https://gis.data.ca.gov/datasets/CDFW::oil-spill-incident-tracking-ds394-1/about>\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}